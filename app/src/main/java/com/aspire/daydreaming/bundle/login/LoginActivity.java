package com.aspire.daydreaming.bundle.login;import android.app.ProgressDialog;import android.content.Intent;import android.os.Bundle;import android.support.v7.widget.Toolbar;import android.text.TextUtils;import android.view.View;import android.widget.AutoCompleteTextView;import android.widget.Button;import android.widget.EditText;import android.widget.TextView;import android.widget.Toast;import com.aspire.daydreaming.R;import com.aspire.daydreaming.bundle.main.MainActivity;import com.aspire.daydreaming.bundle.register.RegisterActivity;import com.aspire.daydreaming.core.base.BaseActivity;import com.aspire.daydreaming.core.dagger2.component.AppComponent;import com.aspire.daydreaming.core.dagger2.component.DaggerApiComponent;import com.aspire.daydreaming.core.dagger2.module.ApiModule;import com.aspire.daydreaming.core.model.UserModel;import com.aspire.daydreaming.core.utils.ConstantUtil;import com.aspire.daydreaming.core.utils.SharedPreferenceUtil;import butterknife.Bind;import butterknife.OnClick;public class LoginActivity extends BaseActivity<LoginPresenter, LoginModel> implements LoginContract.View {    @Bind(R.id.toolbar)    Toolbar toolbar;    @Bind(R.id.tv_title)    TextView tvTitle;    @Bind(R.id.tv_update)    TextView tvUpdate;    @Bind(R.id.username)    AutoCompleteTextView username;    @Bind(R.id.password)    EditText password;    @Bind(R.id.bt_login)    Button btLogin;    @Bind(R.id.bt_register)    Button btRegister;    @Bind(R.id.tv_forget_password)    TextView tvForgetPassword;    private ProgressDialog mDialog;    private String mUsername, mPassword;    @Override    protected void setupActivityComponent(AppComponent appComponent) {        DaggerApiComponent.builder()                .apiModule(new ApiModule(this))                .appComponent(appComponent)                .build()                .inject(this);    }    @Override    public int getLayoutId() {        return R.layout.activity_login;    }    @Override    protected void initView(Bundle savedInstanceState) {        toolbar.setTitle(" ");        tvTitle.setText("用户登录");        setSupportActionBar(toolbar);        getSupportActionBar().setDisplayHomeAsUpEnabled(true);        toolbar.setNavigationOnClickListener(view -> onBackPressed());    }    private void attemptLogin() {        username.setError(null);        password.setError(null);        mUsername = username.getText().toString();        mPassword = password.getText().toString();        boolean cancel = false;        View focusView = null;        if (TextUtils.isEmpty(mUsername)) {            username.setError(getString(R.string.error_field_required));            focusView = username;            cancel = true;        } else if (TextUtils.isEmpty(mPassword)) {            password.setError(getString(R.string.error_invalid_password));            focusView = password;            cancel = true;        }        if (cancel) {            focusView.requestFocus();        } else {            onLoading("正在登录...");            mPresenter.login(mUsername, mPassword);        }    }    @OnClick({R.id.bt_login, R.id.bt_register, R.id.tv_forget_password})    public void onClick(View view) {        switch (view.getId()) {            case R.id.bt_login:                attemptLogin();                break;            case R.id.bt_register:                startActivity(new Intent().setClass(LoginActivity.this, RegisterActivity.class));                break;            case R.id.tv_forget_password:                //TODO                break;        }    }    @Override    public void onLoading(String msg) {        mDialog = new ProgressDialog(mContext);        mDialog.setCancelable(false);        mDialog.setMessage(msg);        mDialog.show();    }    @Override    public void login(String username, String password) {        onLoading("正在登录...");        mPresenter.login(username, password);    }    @Override    public void onComplete(UserModel userModel) {        mDialog.dismiss();        Toast.makeText(LoginActivity.this, "登录成功", Toast.LENGTH_SHORT).show();        SharedPreferenceUtil.saveObject(mContext, ConstantUtil.key.USER_INFO, userModel, ConstantUtil.fileName.USER);        loginSuccess();    }    @Override    public void loginSuccess() {        startActivity(new Intent().setClass(LoginActivity.this, MainActivity.class));        finish();    }    @Override    public void onError(String errorMsg) {        mDialog.dismiss();        Toast.makeText(LoginActivity.this, errorMsg, Toast.LENGTH_SHORT).show();    }}