package com.aspire.daydreaming.bundle.register;import android.app.ProgressDialog;import android.content.Intent;import android.os.Bundle;import android.support.v7.widget.Toolbar;import android.text.TextUtils;import android.view.View;import android.widget.Button;import android.widget.EditText;import android.widget.TextView;import android.widget.Toast;import com.aspire.daydreaming.R;import com.aspire.daydreaming.bundle.main.MainActivity;import com.aspire.daydreaming.core.base.BaseActivity;import com.aspire.daydreaming.core.base.BaseEntity;import com.aspire.daydreaming.core.model.info.User;import com.aspire.daydreaming.core.model.info._User;import com.aspire.daydreaming.core.utils.ActivityManager;import com.aspire.daydreaming.core.utils.ConstantUtil;import com.aspire.daydreaming.core.utils.SharedPreferenceUtil;import butterknife.Bind;import butterknife.OnClick;public class RegisterActivity extends BaseActivity<RegisterPresenter, RegisterModel> implements RegisterContract.View {    @Bind(R.id.toolbar)    Toolbar toolbar;    @Bind(R.id.tv_title)    TextView tvTitle;    @Bind(R.id.tv_update)    TextView tvUpdate;    @Bind(R.id.et_username)    EditText etUsername;    @Bind(R.id.et_password)    EditText etPassword;    @Bind(R.id.bt_register)    Button btRegister;    private ProgressDialog mDialog;    private _User mUser;    @Override    public int getLayoutId() {        return R.layout.activity_register;    }    @Override    protected void initView(Bundle savedInstanceState) {        toolbar.setTitle(" ");        tvTitle.setText("注册");        setSupportActionBar(toolbar);        getSupportActionBar().setDisplayHomeAsUpEnabled(true);        toolbar.setNavigationOnClickListener(view -> onBackPressed());    }    private void attemptRegister() {        etUsername.setError(null);        etPassword.setError(null);        String mUsername = etUsername.getText().toString();        String mPassword = etPassword.getText().toString();        boolean cancel = false;        View focusView = null;        if (TextUtils.isEmpty(mUsername)) {            etUsername.setError(getString(R.string.error_field_required));            focusView = etUsername;            cancel = true;        } else if (TextUtils.isEmpty(mPassword) || mPassword.contains(" ") || mPassword.length() < 4) {            etPassword.setError(getString(R.string.error_invalid_password));            focusView = etPassword;            cancel = true;        }        if (cancel) {            focusView.requestFocus();        } else {            onLoading("正在注册...");            mUser = new _User();            mUser.setUsername(mUsername);            mUser.setPassword(mPassword);            mPresenter.register(new User(mUsername, mPassword));        }    }    @Override    public void onLoading(String msg) {        mDialog = new ProgressDialog(this);        mDialog.setCancelable(false);        mDialog.setMessage(msg);        mDialog.show();    }    @Override    public void onComplete(BaseEntity.BaseBean baseBean) {        mDialog.dismiss();        Toast.makeText(RegisterActivity.this, "注册成功", Toast.LENGTH_SHORT).show();        mUser.objectId = baseBean.objectId;        mUser.updatedAt = baseBean.updatedAt;        mUser.createdAt = baseBean.createdAt;        SharedPreferenceUtil.saveObject(this, ConstantUtil.key.USER_INFO, mUser, ConstantUtil.fileName.USER);        startActivity(new Intent(this, MainActivity.class));        finish();        ActivityManager.getInstance().destroyAllActivity();    }    @Override    public void onError(String errorMsg) {        mDialog.dismiss();        Toast.makeText(RegisterActivity.this, errorMsg, Toast.LENGTH_SHORT).show();    }    @OnClick(R.id.bt_register)    public void onClick() {        attemptRegister();    }}